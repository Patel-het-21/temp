<div class="container">
  <h1>Employee List</h1>

  <div class="top-actions">
    <div class="search-container">
      <input type="text" [(ngModel)]="searchTerm" placeholder="Search by name..." (input)="search()">
    </div>
    <div><button class="btn-add" (click)="addEmployee()">+ Add Employee</button></div>
  </div>

  <div class="table-responsive">
    <table *ngIf="!loading && filteredEmployees.length > 0">
      <thead>
        <tr>
          <th (click)="sortData('id')">ID <span class="sort-icon">{{ currentSortField==='id'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('name')">Name <span class="sort-icon">{{ currentSortField==='name'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('gender')">Gender <span class="sort-icon">{{ currentSortField==='gender'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('dob')">DOB <span class="sort-icon">{{ currentSortField==='dob'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('age')">Age <span class="sort-icon">{{ currentSortField==='age'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('mobile')">Mobile <span class="sort-icon">{{ currentSortField==='mobile'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('email')">Email <span class="sort-icon">{{ currentSortField==='email'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th (click)="sortData('address1')">Address <span class="sort-icon">{{ currentSortField==='address1'?
              (currentSortOrder==='asc'?'▲':'▼') : ''}}</span></th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let emp of paginatedEmployees; let i = index; trackBy: trackByEmpId">
          <td>{{ ((currentPage-1)*rowsPerPage) + i + 1 }}</td>
          <td title="{{ emp.firstName }} {{ emp.lastName }}">
            {{ emp.firstName }} {{ emp.lastName }}
          </td>
          <td>{{ emp.gender }}</td>
          <td>{{ emp.dateOfBirth }}</td>
          <td>{{ emp.age }}</td>
          <td>{{ emp.mobile }}</td>
          <td title="{{ emp.email }}">
            {{ emp.email }}
          </td>

          <td title="{{ emp.address1 + ' ' + emp.address2 }}">
            {{ emp.address1 }} {{ emp.address2 }}
          </td>
          <td>
            <button class="action-btn btn-edit" (click)="editEmployee(emp.id)">Edit</button>
            <button class="action-btn btn-delete" (click)="openDeleteModal(emp.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="!loading && filteredEmployees.length === 0" class="no-data">No employees found</p>
    <p *ngIf="loading" class="no-data">Loading...</p>
  </div>
  <div class="pagination-wrapper" *ngIf="filteredEmployees.length > 0">
    <div class="pagination-right">
      <div class="items-per-page">
        <span>Items per page</span>
        <select [(ngModel)]="rowsPerPage" (change)="onRowsPerPageChange()">
          <option *ngFor="let size of rowsPerPageOptions" [ngValue]="size">
            {{ size }}
          </option>
        </select>
      </div>

      <div class="pagination-info">
        {{ startItem }} – {{ endItem }} of {{ filteredEmployees.length }}
      </div>

      <div class="pagination-buttons">
        <button class="page-link" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
          ‹
        </button>
        <button class="page-link" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
          ›
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Custom Delete Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Confirm Delete</h2>
      <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this employee?</p>
      <p class="warning-text">This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn btn-cancel" (click)="closeDeleteModal()">Cancel</button>
      <button class="modal-btn btn-confirm" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>